{% extends "base.html" %}

{% block title %}{{ trip.tripName }} | Mis Viajes{% endblock %}

{% block extra_css %}
<style>
    .detail-card {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .item-detail {
        padding: 1.5rem;
        background: #f9fafb;
        border-radius: 12px;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('tripBuilder.my_trips') }}">Mis Viajes</a></li>
            <li class="breadcrumb-item active">{{ trip.tripName }}</li>
        </ol>
    </nav>

    <div class="detail-card">
        <div class="d-flex justify-content-between align-items-start mb-4">
            <div>
                <h2 class="fw-bold mb-2">{{ trip.tripName }}</h2>
                <p class="text-muted mb-0">
                    <i class="far fa-calendar me-2"></i>
                    Creado: {{ trip.createdAt.strftime('%d de %B, %Y') }}
                </p>
            </div>
            <span class="badge bg-success rounded-pill px-3 py-2">{{ trip.status|capitalize }}</span>
        </div>

        <h4 class="fw-bold mb-3"><i class="fas fa-list-ul me-2"></i>Servicios Incluidos</h4>
        
        {% for item in trip.items %}
        <div class="item-detail">
            <div class="row align-items-center">
                <div class="col-auto">
                    {% if item.itemType == 'accommodation' %}
                    <i class="fas fa-hotel fa-2x text-primary"></i>
                    {% elif item.itemType == 'flight' %}
                    <i class="fas fa-plane fa-2x text-info"></i>
                    {% elif item.itemType == 'cruise' %}
                    <i class="fas fa-ship fa-2x text-cyan"></i>
                    {% elif item.itemType == 'car_rental' %}
                    <i class="fas fa-car fa-2x text-success"></i>
                    {% elif item.itemType == 'tour' %}
                    <i class="fas fa-ticket-alt fa-2x text-warning"></i>
                    {% elif item.itemType == 'transport' %}
                    <i class="fas fa-bus fa-2x text-secondary"></i>
                    {% endif %}
                </div>
                <div class="col">
                    <h6 class="fw-bold mb-1">
                        {% set details = item.itemDetails|from_json if item.itemDetails else {} %}
                        {% if item.itemType == 'accommodation' %}
                            <span class="text-primary">{{ details.get('name', 'Hotel') }}</span>
                            <small class="d-block text-muted">{{ details.get('address', '') }}</small>
                        {% elif item.itemType == 'flight' %}
                            <span class="text-primary">{{ details.get('origin', 'Origen') }}</span> 
                            <i class="fas fa-arrow-right mx-1"></i> 
                            <span class="text-primary">{{ details.get('destination', 'Destino') }}</span>
                            <small class="d-block text-muted">{{ details.get('aeroline', '') }}</small>
                        {% elif item.itemType == 'cruise' %}
                            <span class="text-primary">{{ details.get('name', 'Crucero') }}</span>
                            <small class="d-block text-muted">{{ details.get('description', '') }}</small>
                        {% elif item.itemType == 'car_rental' %}
                            <span class="text-primary">{{ details.get('brand', '') }} {{ details.get('model', '') }}</span>
                        {% elif item.itemType == 'tour' %}
                            <span class="text-primary">{{ details.get('name', 'Tour') }}</span>
                        {% elif item.itemType == 'transport' %}
                            <span class="text-primary">{{ details.get('origin', 'Origen') }}</span> 
                            <i class="fas fa-arrow-right mx-1"></i> 
                            <span class="text-primary">{{ details.get('destination', 'Destino') }}</span>
                            <small class="d-block text-muted">{{ details.get('type', '')|capitalize }}</small>
                        {% endif %}
                    </h6>
                    <p class="text-muted small mb-0">Referencia: #{{ item.itemId }}</p>
                </div>
                <div class="col-auto text-end">
                    <h5 class="text-success mb-0">{{ item.itemPrice }}€</h5>
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="border-top pt-4 mt-4">
            <div class="row align-items-center">
                <div class="col">
                    <h4 class="fw-bold mb-0">Total del Viaje</h4>
                </div>
                <div class="col-auto">
                    <h2 class="text-success mb-0">{{ trip.totalPrice }}€</h2>
                </div>
            </div>
        </div>

        <div class="d-flex gap-3 mt-4">
            <a href="{{ url_for('tripBuilder.my_trips') }}" class="btn btn-outline-secondary rounded-pill px-4">
                <i class="fas fa-arrow-left me-2"></i>Volver a Mis Viajes
            </a>
            {% if trip.status in ['draft', 'confirmed'] %}
            <form action="{{ url_for('tripBuilder.cancel_trip', idUserTrip=trip.idUserTrip) }}" 
                  method="post" 
                  onsubmit="return confirm('¿Estás seguro de cancelar este viaje?');">
                <button type="submit" class="btn btn-outline-danger rounded-pill px-4">
                    <i class="fas fa-times me-2"></i>Cancelar Viaje
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
